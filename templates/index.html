<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AAC Communication Assistant</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
<script>tailwind.config={theme:{extend:{colors:{primary:'#8E6FF7',secondary:'#FF6B6B'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}
</script>
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
.hide-number-arrows::-webkit-outer-spin-button,
.hide-number-arrows::-webkit-inner-spin-button {
-webkit-appearance: none;
margin: 0;
}
.hide-number-arrows {
-moz-appearance: textfield;
appearance: none;
}
.hide-scrollbar::-webkit-scrollbar {
display: none;
}
.hide-scrollbar {
-ms-overflow-style: none;
scrollbar-width: none;
}
@keyframes micPulse {
0% { box-shadow: 0 0 0 0 rgba(142, 111, 247, 0.5); }
70% { box-shadow: 0 0 0 16px rgba(142, 111, 247, 0); }
100% { box-shadow: 0 0 0 0 rgba(142, 111, 247, 0); }
}
@keyframes speakPulse {
0% { transform: scale(1); }
50% { transform: scale(1.05); }
100% { transform: scale(1); }
}
@keyframes speakWave {
0% { height: 5px; }
25% { height: 15px; }
50% { height: 10px; }
75% { height: 20px; }
100% { height: 5px; }
}
@keyframes typing {
from { width: 0 }
to { width: 100% }
}
.typing-animation {
display: inline-block;
overflow: hidden;
white-space: nowrap;
animation: typing 2s steps(40, end);
}
.mic-recording {
animation: micPulse 1.5s infinite;
background-color: #8E6FF7 !important;
color: white !important;
transform: scale(1.1);
transition: all 0.3s ease;
}
.speak-active {
animation: speakPulse 1.5s infinite;
}
.speaking-indicator {
display: flex;
align-items: center;
justify-content: center;
gap: 2px;
}
.speaking-indicator span {
display: inline-block;
width: 3px;
height: 5px;
border-radius: 1px;
background-color: white;
animation: speakWave 1.2s infinite;
}
.speaking-indicator span:nth-child(2) {
animation-delay: 0.2s;
}
.speaking-indicator span:nth-child(3) {
animation-delay: 0.4s;
}
.speaking-indicator span:nth-child(4) {
animation-delay: 0.6s;
}
.listening-overlay {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: rgba(0, 0, 0, 0.5);
z-index: 100;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
opacity: 0;
pointer-events: none;
transition: opacity 0.3s ease;
}
.listening-overlay.active {
opacity: 1;
pointer-events: auto;
}
.listening-indicator {
width: 120px;
height: 120px;
border-radius: 50%;
background-color: #8E6FF7;
display: flex;
align-items: center;
justify-content: center;
margin-bottom: 20px;
animation: micPulse 1.5s infinite;
}
.listening-status {
color: white;
font-size: 1.25rem;
font-weight: 500;
margin-top: 10px;
}
.history-item {
transition: all 0.3s ease;
}
.history-item:hover {
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}
.keyboard-focus:focus {
outline: 2px solid #8E6FF7;
outline-offset: 2px;
}
.feedback-toast {
transform: translateY(100%);
transition: transform 0.3s ease;
}
.feedback-toast.show {
transform: translateY(0);
}
.context-chip {
transition: all 0.3s ease;
}
.context-chip:hover {
background-color: rgba(142, 111, 247, 0.2);
}
.context-override-dropdown {
position: absolute;
top: 100%;
left: 0;
right: 0;
background-color: white;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
padding: 8px;
z-index: 20;
margin-top: 8px;
display: none;
}
.context-override-dropdown.show {
display: block;
}
.context-option {
padding: 6px 12px;
border-radius: 4px;
cursor: pointer;
transition: background-color 0.2s ease;
}
.context-option:hover {
background-color: rgba(142, 111, 247, 0.1);
}

/* Dark mode styles */
/* Dark mode styles */
.dark {
background-color: #121212;
color: #e0e0e0;
}
.dark body {
background-color: #121212;
}
.dark nav,
.dark .bg-white {
background-color: #1e1e1e !important;
}
.dark .shadow-sm {
box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
}
.dark .text-gray-900 {
color: #e0e0e0 !important;
}
.dark .text-gray-800 {
color: #e0e0e0 !important;
}
.dark .text-gray-700,
.dark .text-gray-600 {
color: #b0b0b0 !important;
}
.dark .text-gray-500 {
color: #a0a0a0 !important;
}
.dark .text-gray-400 {
color: #909090 !important;
}
.dark .bg-gray-100 {
background-color: #2a2a2a !important;
}
.dark .bg-gray-200 {
background-color: #333333 !important;
}
.dark .border-gray-200 {
border-color: #333333 !important;
}
.dark .bg-gray-700 {
background-color: #424242 !important;
}
.dark .text-gray-300 {
color: #b0b0b0 !important;
}
.dark #outputArea {
background-color: #2a2a2a !important;
}
.dark #outputText {
color: #e0e0e0 !important;
}
.dark .suggestion-btn {
background-color: rgba(142, 111, 247, 0.2) !important;
}
.dark .category-tab:not(.bg-primary) {
background-color: #2a2a2a !important;
color: #b0b0b0 !important;
}
.dark .history-item {
background-color: #2a2a2a !important;
}
.dark .history-item:hover {
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}
.dark .feedback-toast {
background-color: #2a2a2a;
color: #e0e0e0;
}
.dark #assistantGreeting {
color: #e0e0e0 !important;
}
.dark .bg-gray-50 {
background-color: #121212 !important;
}
.dark .quick-category {
background-color: #1e1e1e !important;
border-color: #333333 !important;
}
.dark .quick-category:hover {
border-color: #8E6FF7 !important;
}
.dark .border {
border-color: #333333 !important;
}

/* Hover states */
button:hover:not(.bg-primary) {
transform: translateY(-2px);
transition: all 0.2s ease;
}
.suggestion-btn:hover,
.category-tab:hover:not(.bg-primary) {
transform: translateY(-2px);
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
transition: all 0.2s ease;
}
.dark .suggestion-btn:hover,
.dark .category-tab:hover:not(.bg-primary) {
box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
}
/* Active states */
button:active {
transform: translateY(0);
transition: all 0.1s ease;
}
</style>
</head>
<body class="bg-gray-50 font-inter min-h-screen text-gray-900 transition-colors duration-300">
<div id="root" class="min-h-screen">
<div id="listeningOverlay" class="listening-overlay">
<div class="listening-indicator">
<i class="ri-mic-line ri-3x text-white"></i>
</div>
<div class="listening-status">Listening...</div>
<p class="text-white text-center mt-4 max-w-md px-4">Speak clearly and I'll help you communicate</p>
<div id="context-display" class="p-4 rounded-lg bg-gray-50 dark:bg-gray-800">
    <div class="context-info">
        <div class="context-label">
            <strong>Context:</strong> <span id="context-label">Loading...</span>
            <span id="context-confidence" class="confidence"></span>
        </div>
        <div class="context-details">
            <div class="time-location">
                <span id="time-of-day">...</span>
                <span id="day-type">...</span>
                <span id="location">...</span>
            </div>
            <div class="additional-context">
                <span id="activity">...</span>
                <span id="formality">...</span>
            </div>
        </div>
    </div>
</div>
<button id="cancelListening" class="mt-8 px-6 py-2 bg-white text-primary rounded-full font-medium hover:bg-gray-100 transition-all duration-300 !rounded-button">
Cancel
</button>
</div>
<nav class="bg-white shadow-sm fixed w-full top-0 z-50">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between h-16">
<div class="flex items-center space-x-3">
<div class="text-2xl font-['Pacifico'] text-primary">logo</div>
<div class="text-lg font-medium text-gray-700">Communication Assistant</div>
</div>
<div class="flex items-center space-x-4">
<button id="settingsBtn" class="w-10 h-10 flex items-center justify-center text-gray-600 hover:text-primary cursor-pointer transition-all duration-300 hover:bg-gray-100 rounded-full">
<i class="ri-settings-3-line ri-xl"></i>
</button>
<button id="profileBtn" class="w-10 h-10 flex items-center justify-center text-gray-600 hover:text-primary cursor-pointer transition-all duration-300 hover:bg-gray-100 rounded-full">
<i class="ri-user-line ri-xl"></i>
</button>
</div>
</div>
</div>
</nav>
<main class="pt-16 pb-20">
<div id="communicationScreen" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
<div class="bg-white rounded-lg shadow-sm p-6 mb-10">
<div class="mb-6">
<div class="flex items-center justify-between">
<div class="flex items-center space-x-3">
<div class="w-10 h-10 bg-primary bg-opacity-10 rounded-full flex items-center justify-center">
<i class="ri-message-3-line text-primary ri-lg"></i>
</div>
<div id="assistantGreeting" class="text-xl font-medium text-gray-800 text-center py-2">
<span class="typing-animation">Hi Yujun, ready when you are.</span>
</div>
</div>
<div class="flex items-center space-x-3">
<button id="darkModeToggle" class="w-10 h-10 flex items-center justify-center text-gray-600 hover:text-primary bg-gray-100 rounded-full cursor-pointer transition-all duration-300 hover:shadow-md keyboard-focus" tabindex="0" aria-label="Toggle dark mode">
<i class="ri-moon-line ri-lg"></i>
</button>
<div class="relative">
<button id="contextModeToggle" class="flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-full cursor-pointer transition-all duration-300 hover:shadow-md keyboard-focus" tabindex="0" aria-label="Toggle context mode">
<i class="ri-radar-line"></i>
<span>Smart Context</span>
<span class="ml-1 text-xs bg-white text-primary px-1.5 py-0.5 rounded-full">ON</span>
</button>
<div id="contextTooltip" class="absolute right-0 -bottom-16 bg-white rounded-lg shadow-lg p-3 text-xs text-gray-600 hidden z-10 w-64">
Suggestions are based on your environment. Turn off Smart Context to choose manually.
</div>
</div>
</div>
</div>
<div id="activeContextInfo" class="flex flex-wrap items-center mt-4 space-x-2 transition-opacity duration-300">
<div class="flex items-center space-x-2 bg-gray-50 px-3 py-2 rounded-lg">
<div class="context-chip flex items-center space-x-1 px-2 py-1 bg-primary bg-opacity-10 text-primary rounded-full text-xs">
<i class="ri-time-line"></i>
<span id="timeContext">Morning</span>
</div>
<div class="context-chip flex items-center space-x-1 px-2 py-1 bg-primary bg-opacity-10 text-primary rounded-full text-xs">
<i class="ri-map-pin-line"></i>
<span id="locationContext">Home</span>
</div>
<div class="context-chip flex items-center space-x-1 px-2 py-1 bg-primary bg-opacity-10 text-primary rounded-full text-xs">
<i class="ri-calendar-line"></i>
<span id="dayContext">Weekday</span>
</div>
<button id="manualOverrideBtn" class="flex items-center justify-center w-6 h-6 bg-gray-200 rounded-full text-gray-600 hover:bg-primary hover:text-white transition-colors duration-300">
<i class="ri-edit-line ri-xs"></i>
</button>
</div>
<div class="text-sm text-gray-500 ml-2">Suggestions tailored to your current context</div>
</div>
</div>
<div class="flex items-center space-x-3 overflow-x-auto py-3 scrollbar-hide hide-scrollbar">
<button class="category-tab flex items-center space-x-2 px-6 py-3 bg-primary text-white rounded-full whitespace-nowrap shadow-md transition-all duration-300 keyboard-focus" data-category="all" tabindex="0" aria-label="All categories">
<i class="ri-home-line"></i>
<span>All</span>
</button>
<button class="category-tab flex items-center space-x-2 px-6 py-3 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap transition-all duration-300 keyboard-focus" data-category="emotions" tabindex="0" aria-label="Emotions category">
<i class="ri-emotion-happy-line"></i>
<span>Emotions</span>
</button>
<button class="category-tab flex items-center space-x-2 px-6 py-3 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap transition-all duration-300 keyboard-focus" data-category="food" tabindex="0" aria-label="Food category">
<i class="ri-restaurant-line"></i>
<span>Food</span>
</button>
<button class="category-tab flex items-center space-x-2 px-6 py-3 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap transition-all duration-300 keyboard-focus" data-category="home" tabindex="0" aria-label="Home category">
<i class="ri-home-line"></i>
<span>Home</span>
</button>
<button class="category-tab flex items-center space-x-2 px-6 py-3 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap transition-all duration-300 keyboard-focus" data-category="health" tabindex="0" aria-label="Health category">
<i class="ri-heart-pulse-line"></i>
<span>Health</span>
</button>
<button class="category-tab flex items-center space-x-2 px-6 py-3 bg-gray-100 text-gray-700 rounded-full whitespace-nowrap transition-all duration-300 keyboard-focus" data-category="social" tabindex="0" aria-label="Social category">
<i class="ri-group-line"></i>
<span>Social</span>
</button>
</div>
</div>
<div class="bg-gray-100 rounded-lg p-6 mb-8 min-h-[150px] shadow-sm transition-all duration-300" id="outputArea">
<textarea class="w-full bg-transparent border-none outline-none resize-none text-xl text-gray-800 min-h-[120px] placeholder-gray-400 keyboard-focus" id="outputText" placeholder="Type what you want to say..." tabindex="0" aria-label="Text output area"></textarea>
</div>
<div class="flex items-center space-x-4 mb-8 overflow-x-auto py-4 hide-scrollbar" id="suggestions" style="scroll-behavior: smooth; -webkit-overflow-scrolling: touch;">
<button class="suggestion-btn px-4 py-2 bg-primary bg-opacity-10 text-primary rounded-full whitespace-nowrap text-sm font-medium hover:bg-opacity-30 cursor-pointer transition-all duration-300 keyboard-focus" data-category="all" tabindex="0">How are you?</button>
<button class="suggestion-btn px-4 py-2 bg-primary bg-opacity-10 text-primary rounded-full whitespace-nowrap text-sm font-medium hover:bg-opacity-30 cursor-pointer transition-all duration-300 keyboard-focus" data-category="all" tabindex="0">I need help</button>
<button class="suggestion-btn px-4 py-2 bg-primary bg-opacity-10 text-primary rounded-full whitespace-nowrap text-sm font-medium hover:bg-opacity-30 cursor-pointer transition-all duration-300 keyboard-focus" data-category="all" tabindex="0">Thank you</button>
<button class="suggestion-btn px-4 py-2 bg-primary bg-opacity-10 text-primary rounded-full whitespace-nowrap text-sm font-medium hover:bg-opacity-30 cursor-pointer transition-all duration-300 keyboard-focus" data-category="all" tabindex="0">Yes, please</button>
<button class="suggestion-btn px-4 py-2 bg-primary bg-opacity-10 text-primary rounded-full whitespace-nowrap text-sm font-medium hover:bg-opacity-30 cursor-pointer transition-all duration-300 keyboard-focus" data-category="all" tabindex="0">No, thanks</button>
</div>
<div class="grid grid-cols-3 gap-6 mb-10">
<button class="quick-category p-6 bg-white border border-gray-200 rounded-lg text-center hover:border-primary hover:shadow-md cursor-pointer transition-all duration-300 keyboard-focus" data-category="emotions" tabindex="0" aria-label="Feelings category">
<i class="ri-emotion-happy-line ri-2x mb-4 text-primary"></i>
<p class="text-sm font-medium text-gray-700">Feelings</p>
</button>
<button class="quick-category p-6 bg-white border border-gray-200 rounded-lg text-center hover:border-primary hover:shadow-md cursor-pointer transition-all duration-300 keyboard-focus" data-category="food" tabindex="0" aria-label="Food and drink category">
<i class="ri-restaurant-line ri-2x mb-4 text-primary"></i>
<p class="text-sm font-medium text-gray-700">Food & Drink</p>
</button>
<button class="quick-category p-6 bg-white border border-gray-200 rounded-lg text-center hover:border-primary hover:shadow-md cursor-pointer transition-all duration-300 keyboard-focus" data-category="home" tabindex="0" aria-label="Daily needs category">
<i class="ri-home-line ri-2x mb-4 text-primary"></i>
<p class="text-sm font-medium text-gray-700">Daily Needs</p>
</button>
</div>
<div class="flex items-center justify-between">
<button id="clearBtn" class="w-14 h-14 flex items-center justify-center text-gray-600 hover:text-primary bg-gray-100 rounded-full cursor-pointer transition-all duration-300 hover:shadow-md keyboard-focus" tabindex="0" aria-label="Clear text">
<i class="ri-delete-bin-line ri-lg"></i>
</button>
<button id="speakBtn" class="px-10 py-4 bg-primary text-white rounded-full font-medium hover:bg-primary/90 flex items-center space-x-3 cursor-pointer transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1 keyboard-focus !rounded-button" tabindex="0" aria-label="Speak text">
<i class="ri-volume-up-line ri-lg"></i>
<span class="text-base speaking-text">Speak</span>
<div class="speaking-indicator hidden">
<span></span>
<span></span>
<span></span>
<span></span>
</div>
</button>
<button id="micBtn" class="w-16 h-16 flex items-center justify-center text-gray-600 hover:text-primary bg-gray-100 rounded-full cursor-pointer transition-all duration-300 hover:shadow-lg keyboard-focus relative" tabindex="0" aria-label="Record speech">
<i class="ri-mic-line ri-xl"></i>
<span class="absolute -top-1 -right-1 bg-primary text-white text-xs px-2 py-1 rounded-full opacity-0 transition-opacity duration-300" id="micTooltip">Listen</span>
</button>
</div>
</div>
<div class="bg-white rounded-lg shadow-sm p-8 transition-all duration-300">
<div class="flex items-center justify-between mb-6">
<h3 class="text-lg font-semibold text-gray-900 border-l-4 border-primary pl-3">Recent History</h3>
<div class="relative">
<button id="historyFilterBtn" class="flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-full cursor-pointer transition-all duration-300 hover:shadow-md keyboard-focus" tabindex="0" aria-label="Filter history">
<i class="ri-filter-3-line"></i>
<span>Filter</span>
</button>
<div id="historyFilterDropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg p-2 hidden z-10">
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus" data-filter="all" tabindex="0">All Contexts</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus" data-filter="Work" tabindex="0">Work</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus" data-filter="Health" tabindex="0">Health</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus" data-filter="General" tabindex="0">General</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus" data-filter="Emotions" tabindex="0">Emotions</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus" data-filter="Food" tabindex="0">Food</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus" data-filter="Social" tabindex="0">Social</button>
</div>
</div>
</div>
<div class="space-y-4" id="historyList">
</div>
</div>
</div>
<!-- Feedback Toast -->
<div id="feedbackToast" class="fixed bottom-0 left-0 right-0 mx-auto w-full max-w-md bg-white rounded-t-lg shadow-lg p-4 flex items-center justify-between feedback-toast z-50">
<div class="flex items-center space-x-3">
<div class="w-8 h-8 flex items-center justify-center bg-primary bg-opacity-10 text-primary rounded-full">
<i class="ri-check-line"></i>
</div>
<p class="text-gray-800" id="feedbackMessage">Text spoken successfully</p>
</div>
<button id="closeFeedback" class="text-gray-400 hover:text-gray-600">
<i class="ri-close-line"></i>
</button>
</div>
</main>
<div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
<div class="absolute inset-y-0 right-0 max-w-md w-full bg-white shadow-lg">
<div class="p-6">
<div class="flex items-center justify-between mb-6">
<h2 class="text-xl font-semibold text-gray-900">Settings</h2>
<button class="closeModal w-10 h-10 flex items-center justify-center text-gray-600 hover:text-primary cursor-pointer">
<i class="ri-close-line ri-xl"></i>
</button>
</div>
<div class="space-y-6">
<div class="space-y-4">
<h3 class="text-sm font-medium text-gray-700">Voice Settings</h3>
<div class="flex items-center space-x-4">
<button id="maleVoiceBtn" class="px-4 py-2 bg-primary text-white rounded-full text-sm font-medium cursor-pointer">Male</button>
<button id="femaleVoiceBtn" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium cursor-pointer">Female</button>
</div>
<div class="space-y-2">
<label class="text-sm text-gray-600">Speed</label>
<input type="range" min="0.5" max="2" value="1" step="0.1" class="w-full" id="voiceSpeed">
</div>
<div class="space-y-2">
<label class="text-sm text-gray-600">Pitch</label>
<input type="range" min="0.5" max="2" value="1" step="0.1" class="w-full" id="voicePitch">
</div>
</div>
<div class="space-y-4">
<h3 class="text-sm font-medium text-gray-700">General Settings</h3>
<div class="flex items-center justify-between">
<span class="text-sm text-gray-600">Offline Mode</span>
<label class="relative inline-flex items-center cursor-pointer">
<input type="checkbox" class="sr-only peer">
<div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-gray-800 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-300 after:border-gray-700 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
</label>
</div>
<div class="flex items-center justify-between">
<span class="text-sm text-gray-600">Dark Theme</span>
<label class="relative inline-flex items-center cursor-pointer">
<input type="checkbox" class="sr-only peer">
<div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-gray-800 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-300 after:border-gray-700 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
</label>
</div>
</div>
<div class="space-y-4">
<h3 class="text-sm font-medium text-gray-700">Language</h3>
<div class="relative">
<button id="languageSelector" class="w-full px-4 py-2 bg-gray-700 rounded-lg text-left text-sm text-gray-300 cursor-pointer flex items-center justify-between">
<span id="currentLanguage">English (US)</span>
<i class="ri-arrow-down-s-line"></i>
</button>
<div id="languageDropdown" class="absolute left-0 right-0 mt-2 bg-white rounded-lg shadow-lg p-2 hidden z-10">
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus language-option" data-lang="en-US" tabindex="0">English (US)</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus language-option" data-lang="en-GB" tabindex="0">English (UK)</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus language-option" data-lang="es-ES" tabindex="0">Spanish</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus language-option" data-lang="fr-FR" tabindex="0">French</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus language-option" data-lang="de-DE" tabindex="0">German</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus language-option" data-lang="zh-CN" tabindex="0">Chinese</button>
<button class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded keyboard-focus language-option" data-lang="ja-JP" tabindex="0">Japanese</button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
<div class="absolute inset-y-0 right-0 max-w-md w-full bg-white shadow-lg">
<div class="p-6">
<div class="flex items-center justify-between mb-6">
<h2 class="text-xl font-semibold text-gray-900">Profile</h2>
<button class="closeModal w-10 h-10 flex items-center justify-center text-gray-600 hover:text-primary cursor-pointer">
<i class="ri-close-line ri-xl"></i>
</button>
</div>
<div class="space-y-6">
<div class="flex items-center space-x-4">
<div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
<i class="ri-user-line ri-2x text-gray-400"></i>
</div>
<div>
<h3 class="text-lg font-medium text-gray-900">Yujun Ge</h3>
<p class="text-sm text-gray-600">Last active: Today</p>
</div>
</div>
<div class="space-y-4">
<h3 class="text-sm font-medium text-gray-700">Saved Phrases</h3>
<div class="space-y-2">
<button class="w-full px-4 py-2 bg-gray-100 rounded-lg text-left text-sm text-gray-700 hover:bg-gray-200 cursor-pointer">I'm feeling great today!</button>
<button class="w-full px-4 py-2 bg-gray-100 rounded-lg text-left text-sm text-gray-700 hover:bg-gray-200 cursor-pointer">Could you help me with something?</button>
<button class="w-full px-4 py-2 bg-gray-100 rounded-lg text-left text-sm text-gray-700 hover:bg-gray-200 cursor-pointer">I need a break</button>
</div>
</div>
<button id="addNewPhraseBtn" class="w-full px-4 py-2 border border-primary text-primary rounded-lg text-sm font-medium hover:bg-primary hover:text-white cursor-pointer !rounded-button">
Add New Phrase
</button>
<div id="newPhraseModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
<div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
<div class="flex items-center justify-between mb-4">
<h3 class="text-lg font-semibold text-gray-900">Add New Phrase</h3>
<button id="closeNewPhraseModal" class="w-8 h-8 flex items-center justify-center text-gray-600 hover:text-primary cursor-pointer">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div>
<label for="newPhraseText" class="block text-sm font-medium text-gray-700 mb-1">Phrase</label>
<textarea id="newPhraseText" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" rows="3" placeholder="Enter your phrase here"></textarea>
</div>
<div>
<label for="newPhraseCategory" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
<select id="newPhraseCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent pr-8">
<option value="General">General</option>
<option value="Work">Work</option>
<option value="Health">Health</option>
<option value="Emotions">Emotions</option>
<option value="Food">Food</option>
<option value="Social">Social</option>
</select>
</div>
<div class="flex justify-end space-x-3 pt-2">
<button id="cancelNewPhrase" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 cursor-pointer !rounded-button">Cancel</button>
<button id="saveNewPhrase" class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary/90 cursor-pointer !rounded-button">Save Phrase</button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</main>
</div>
<script>

async function fetchUserLocationName() {
  return new Promise((resolve, reject) => {
    if (!navigator.geolocation) return resolve("Unknown");

    navigator.geolocation.getCurrentPosition(async (position) => {
      const { latitude, longitude } = position.coords;

      // First try Foursquare
      const fsqApiKey = "fsq3rX+qLUv4Vt7uYUIkyXVLe3rhd65P4gad/9/7pAr/0Uk=";
      try {
        const fsqResponse = await fetch(
          `https://api.foursquare.com/v3/places/search?ll=${latitude},${longitude}&limit=1`,
          {
            headers: {
              Accept: "application/json",
              Authorization: fsqApiKey,
            },
          }
        );
        const fsqData = await fsqResponse.json();
        const businessName = fsqData.results?.[0]?.name;
        if (businessName) return resolve(businessName);
      } catch (err) {
        console.warn("Foursquare failed, falling back to city");
      }

      // Fallback to city name
      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`
        );
        const data = await response.json();
        const city =
          data.address.city ||
          data.address.town ||
          data.address.village ||
          data.address.hamlet ||
          "Unknown";
        resolve(city);
      } catch (err) {
        console.error("Reverse geocoding error:", err);
        resolve("Unknown");
      }
    }, () => {
      resolve("Unknown");
    });
  });
}


const mockHistory = [
{ text: "Could you please help me with this task?", time: "10:30 AM", context: "Work" },
{ text: "I'm feeling much better today, thank you!", time: "Yesterday", context: "Health" },
{ text: "The weather is beautiful outside", time: "2 days ago", context: "General" },
{ text: "I would like to order a vegetarian pizza with extra cheese", time: "3 days ago", context: "Food" },
{ text: "Can we schedule a meeting for tomorrow afternoon?", time: "4 days ago", context: "Work" },
{ text: "I'm feeling excited about the upcoming concert", time: "5 days ago", context: "Emotions" },
{ text: "Could you please pass me the water?", time: "1 week ago", context: "Food" },
{ text: "I enjoyed our conversation yesterday", time: "1 week ago", context: "Social" }
];
const phraseSuggestions = {
all: [
"How are you?",
"I need help",
"Thank you",
"Yes, please",
"No, thanks",
"Could you repeat that?",
"I don't understand"
],
emotions: [
"I'm feeling happy today",
"I'm a bit sad",
"I'm excited about this",
"I'm feeling anxious",
"I'm frustrated",
"I'm proud of myself",
"I love you"
],
food: [
"I'm hungry",
"I would like some water",
"Can I have coffee please?",
"I'd like to order pizza",
"This tastes delicious",
"I'm thirsty",
"No more, thank you"
],
home: [
"Please turn on the lights",
"Can you close the window?",
"I need help in the bathroom",
"It's too cold in here",
"I'd like to watch TV",
"Please lock the door",
"I need my medication"
],
health: [
"I'm in pain",
"I need my medication",
"I feel dizzy",
"I need to see a doctor",
"I'm feeling better today",
"I need to rest",
"Can you help me stand up?"
],
social: [
"Nice to meet you",
"How was your day?",
"I'd like to go outside",
"Can we talk later?",
"I enjoyed our conversation",
"Please give me some privacy",
"Let's celebrate together"
]
};
let filteredHistory = [...mockHistory];
let currentFilter = 'all';
function updateHistory(filter = 'all') {
const historyList = document.getElementById('historyList');
filteredHistory = filter === 'all' ?
[...mockHistory] :
mockHistory.filter(item => item.context === filter);
historyList.innerHTML = filteredHistory.map(item => `
<div class="history-item flex items-center justify-between p-5 bg-gray-100 rounded-lg transition-all duration-300 mb-4" data-context="${item.context}">
<div>
<p class="text-gray-900 font-medium">${item.text}</p>
<div class="flex items-center space-x-2 mt-2">
<span class="text-sm text-gray-400">${item.time}</span>
<span class="text-sm text-gray-500">•</span>
<span class="text-sm text-gray-500">${item.context}</span>
</div>
</div>
<div class="flex items-center space-x-3">
<button class="history-reuse w-10 h-10 flex items-center justify-center text-gray-400 hover:text-primary hover:bg-gray-200 rounded-full cursor-pointer transition-all duration-300 keyboard-focus" tabindex="0" aria-label="Reuse this phrase">
<i class="ri-restart-line ri-lg"></i>
</button>
<button class="history-speak w-10 h-10 flex items-center justify-center text-gray-400 hover:text-primary hover:bg-gray-200 rounded-full cursor-pointer transition-all duration-300 keyboard-focus" tabindex="0" aria-label="Speak this phrase">
<i class="ri-volume-up-line ri-lg"></i>
</button>
</div>
</div>
`).join('');
// Add event listeners to history buttons
document.querySelectorAll('.history-reuse').forEach((button, index) => {
button.addEventListener('click', () => {
document.getElementById('outputText').value = filteredHistory[index].text;
// Add a visual feedback
button.classList.add('text-primary', 'bg-gray-200');
setTimeout(() => {
button.classList.remove('text-primary', 'bg-gray-200');
}, 300);
});
});
document.querySelectorAll('.history-speak').forEach((button, index) => {
button.addEventListener('click', () => {
const success = speakText(filteredHistory[index].text);
if (success) {
// Add a visual feedback
button.classList.add('text-primary', 'bg-gray-200');
// Update the main speak button state
updateSpeakButtonState(true);
setTimeout(() => {
button.classList.remove('text-primary', 'bg-gray-200');
}, 300);
showFeedbackToast(`Speaking: "${filteredHistory[index].text.substring(0, 30)}${filteredHistory[index].text.length > 30 ? '...' : ''}"`);
}
});
});
}
function showFeedbackToast(message) {
const toast = document.getElementById('feedbackToast');
const messageEl = document.getElementById('feedbackMessage');
messageEl.textContent = message;
toast.classList.add('show');
setTimeout(() => {
toast.classList.remove('show');
}, 3000);
}
// Initialize speech synthesis voices
function initVoices() {
if (typeof speechSynthesis !== 'undefined') {
speechSynthesis.onvoiceschanged = function() {
// Voices are now loaded
console.log('Voices loaded:', speechSynthesis.getVoices().length);
};
}
}

document.addEventListener('DOMContentLoaded', () => {
  const closeOverrideModal = document.getElementById('closeOverrideModal');
  const manualOverrideModal = document.getElementById('manualOverrideModal');

  if (closeOverrideModal && manualOverrideModal) {
    closeOverrideModal.addEventListener('click', () => {
      manualOverrideModal.classList.add('hidden');
    });
  } else {
    console.warn('Missing #closeOverrideModal or #manualOverrideModal');
  }
});
document.addEventListener('DOMContentLoaded', () => {
updateHistory();
initVoices();
const settingsBtn = document.getElementById('settingsBtn');
const profileBtn = document.getElementById('profileBtn');
const settingsModal = document.getElementById('settingsModal');
const profileModal = document.getElementById('profileModal');
const closeButtons = document.querySelectorAll('.closeModal');
const speakBtn = document.getElementById('speakBtn');
const micBtn = document.getElementById('micBtn');
const outputText = document.getElementById('outputText');
const outputArea = document.getElementById('outputArea');
const suggestionsContainer = document.getElementById('suggestions');
const darkModeToggle = document.getElementById('darkModeToggle');
const categoryTabs = document.querySelectorAll('.category-tab');
const clearBtn = document.getElementById('clearBtn');
const historyFilterBtn = document.getElementById('historyFilterBtn');
const historyFilterDropdown = document.getElementById('historyFilterDropdown');
const feedbackToast = document.getElementById('feedbackToast');
const closeFeedback = document.getElementById('closeFeedback');
const maleVoiceBtn = document.getElementById('maleVoiceBtn');
const femaleVoiceBtn = document.getElementById('femaleVoiceBtn');
const voiceSpeed = document.getElementById('voiceSpeed');
const voicePitch = document.getElementById('voicePitch');
const languageSelector = document.getElementById('languageSelector');
const languageDropdown = document.getElementById('languageDropdown');
const languageOptions = document.querySelectorAll('.language-option');
const addNewPhraseBtn = document.getElementById('addNewPhraseBtn');
const newPhraseModal = document.getElementById('newPhraseModal');
const closeNewPhraseModal = document.getElementById('closeNewPhraseModal');
const newPhraseText = document.getElementById('newPhraseText');
const newPhraseCategory = document.getElementById('newPhraseCategory');
const saveNewPhrase = document.getElementById('saveNewPhrase');
const cancelNewPhrase = document.getElementById('cancelNewPhrase');
const assistantGreeting = document.getElementById('assistantGreeting');
// Update greeting based on time of day
function updateGreeting() {
const userName = "Yujun";
const greeting = `Hi ${userName}, ready when you are.`;
assistantGreeting.innerHTML = `<span class="typing-animation">${greeting}</span>`;
}
// Call the greeting function
updateGreeting();
let isRecording = false;
let currentCategory = 'all';
let selectedVoiceGender = 'male';
let voiceRate = 1;
let savedPhrases = [
"I'm feeling great today!",
"Could you help me with something?",
"I need a break"
];
// Function to update suggestions based on category
function updateSuggestions(category) {
currentCategory = category;
suggestionsContainer.innerHTML = '';
phraseSuggestions[category].forEach(phrase => {
const button = document.createElement('button');
button.className = 'suggestion-btn px-4 py-2 bg-primary bg-opacity-10 text-primary rounded-full whitespace-nowrap text-sm font-medium hover:bg-opacity-20 cursor-pointer keyboard-focus';
button.textContent = phrase;
button.dataset.category = category;
button.setAttribute('tabindex', '0');
button.addEventListener('click', () => {
outputText.value = phrase;
});
suggestionsContainer.appendChild(button);
});
}
// Initialize with default suggestions
updateSuggestions('all');
// History filter dropdown
historyFilterBtn.addEventListener('click', () => {
historyFilterDropdown.classList.toggle('hidden');
});
// Close dropdown when clicking outside
document.addEventListener('click', (e) => {
if (!historyFilterBtn.contains(e.target) && !historyFilterDropdown.contains(e.target)) {
historyFilterDropdown.classList.add('hidden');
}
});
// Filter history items
document.querySelectorAll('#historyFilterDropdown button').forEach(button => {
button.addEventListener('click', () => {
const filter = button.dataset.filter;
currentFilter = filter;
updateHistory(filter);
historyFilterDropdown.classList.add('hidden');
historyFilterBtn.querySelector('span').textContent = filter === 'all' ? 'Filter' : filter;
});
});
// Show tooltip on hover for mic button
micBtn.addEventListener('mouseenter', () => {
document.getElementById('micTooltip').style.opacity = '1';
});
micBtn.addEventListener('mouseleave', () => {
document.getElementById('micTooltip').style.opacity = '0';
});
const listeningOverlay = document.getElementById('listeningOverlay');
const cancelListening = document.getElementById('cancelListening');
cancelListening.addEventListener('click', () => {
stopListening();
});
async function startListening() {
isRecording = true;
micBtn.classList.add('mic-recording');
micBtn.querySelector('i').classList.replace('ri-mic-line', 'ri-mic-fill');
// Show the full-screen overlay
listeningOverlay.classList.add('active');
// Show context indicator if context mode is enabled
const contextIndicator = document.getElementById('contextIndicator');
const currentContextDisplay = document.getElementById('currentContextDisplay');
if (contextModeEnabled) {
const contextInfo = await detectContext();
currentContextDisplay.textContent = contextInfo.activity;
contextIndicator.style.opacity = '1';
} else {
contextIndicator.style.opacity = '0';
}
// Simulate speech recognition after 3 seconds
setTimeout(async () => {
  if (isRecording) {
    let recognizedPhrase;
    if (contextModeEnabled) {
      const contextInfo = await detectContext();
      recognizedPhrase = contextInfo.suggestions[Math.floor(Math.random() * contextInfo.suggestions.length)];
    } else {
      recognizedPhrase = phraseSuggestions[currentCategory][Math.floor(Math.random() * phraseSuggestions[currentCategory].length)];
    }
    outputText.value = recognizedPhrase;
    showFeedbackToast('Speech recognized');
    stopListening();
  }
}, 3000);

}
function stopListening() {
isRecording = false;
micBtn.classList.remove('mic-recording');
micBtn.querySelector('i').classList.replace('ri-mic-fill', 'ri-mic-line');
listeningOverlay.classList.remove('active');
// If context mode is enabled, schedule next auto-listening
if (contextModeEnabled) {
// Random time between 30-90 seconds for next auto-listening
const nextListeningTime = 30000 + Math.random() * 60000;
setTimeout(() => {
if (contextModeEnabled && Math.random() > 0.7) {
// 30% chance of auto-listening
startListening();
}
}, nextListeningTime);
}
}
micBtn.addEventListener('click', () => {
if(!isRecording) {
startListening();
} else {
stopListening();
}
});
darkModeToggle.addEventListener('click', () => {
document.documentElement.classList.toggle('dark');
const icon = darkModeToggle.querySelector('i');
if (document.documentElement.classList.contains('dark')) {
icon.classList.replace('ri-moon-line', 'ri-sun-line');
darkModeToggle.classList.add('bg-primary', 'text-white');
darkModeToggle.classList.remove('bg-gray-100', 'text-gray-600');
// Save preference to localStorage
localStorage.setItem('darkMode', 'enabled');
} else {
icon.classList.replace('ri-sun-line', 'ri-moon-line');
darkModeToggle.classList.remove('bg-primary', 'text-white');
darkModeToggle.classList.add('bg-gray-100', 'text-gray-600');
// Save preference to localStorage
localStorage.setItem('darkMode', 'disabled');
}
});
// Check for saved dark mode preference
const darkModeSetting = localStorage.getItem('darkMode');
if (darkModeSetting === 'enabled') {
darkModeToggle.click(); // Trigger the click event to enable dark mode
}
categoryTabs.forEach(tab => {
tab.addEventListener('click', () => {
const category = tab.dataset.category;
// Update tab styling
categoryTabs.forEach(t => {
t.classList.replace('bg-primary', 'bg-gray-100');
t.classList.replace('text-white', 'text-gray-700');
t.classList.remove('shadow-md');
});
tab.classList.replace('bg-gray-100', 'bg-primary');
tab.classList.replace('text-gray-700', 'text-white');
tab.classList.add('shadow-md');
// Update suggestions based on category
updateSuggestions(category);
});
});
settingsBtn.addEventListener('click', () => {
settingsModal.classList.remove('hidden');
});
profileBtn.addEventListener('click', () => {
profileModal.classList.remove('hidden');
});
closeButtons.forEach(button => {
button.addEventListener('click', () => {
settingsModal.classList.add('hidden');
profileModal.classList.add('hidden');
});
});
closeFeedback.addEventListener('click', () => {
feedbackToast.classList.remove('show');
});
clearBtn.addEventListener('click', () => {
outputText.value = '';
showFeedbackToast('Text cleared');
});
function speakText(text) {
if (text) {
// Cancel any ongoing speech
window.speechSynthesis.cancel();
const utterance = new SpeechSynthesisUtterance(text);
// Set language
utterance.lang = currentLanguage;
// Set rate and pitch
utterance.rate = voiceRate;
utterance.pitch = voicePitch;
// Get available voices
const voices = window.speechSynthesis.getVoices();
// Filter voices by gender and language
let filteredVoices = voices.filter(voice =>
voice.lang.includes(currentLanguage.split('-')[0]) ||
voice.lang === currentLanguage
);
// If no matching voices found, use any available voice
if (filteredVoices.length === 0) {
filteredVoices = voices;
}
// Try to find a voice matching the selected gender
let selectedVoice = null;
if (selectedVoiceGender === 'male') {
selectedVoice = filteredVoices.find(voice => !voice.name.includes('female') && !voice.name.toLowerCase().includes('girl'));
} else {
selectedVoice = filteredVoices.find(voice => voice.name.includes('female') || voice.name.toLowerCase().includes('girl'));
}
// If no matching gender voice found, use the first available voice
if (!selectedVoice && filteredVoices.length > 0) {
selectedVoice = filteredVoices[0];
}
if (selectedVoice) {
utterance.voice = selectedVoice;
}
// Add event listeners for speech events
utterance.onstart = function() {
updateSpeakButtonState(true);
};
utterance.onend = function() {
updateSpeakButtonState(false);
showFeedbackToast('Speaking complete');
};
utterance.onerror = function() {
updateSpeakButtonState(false);
showFeedbackToast('Error while speaking');
};
window.speechSynthesis.speak(utterance);
return true;
}
return false;
}
function updateSpeakButtonState(isSpeaking) {
const speakingText = speakBtn.querySelector('.speaking-text');
const speakingIndicator = speakBtn.querySelector('.speaking-indicator');
if (isSpeaking) {
speakBtn.classList.add('speak-active');
speakingText.textContent = 'Speaking';
speakingIndicator.classList.remove('hidden');
} else {
speakBtn.classList.remove('speak-active');
speakingText.textContent = 'Speak';
speakingIndicator.classList.add('hidden');
}
}
speakBtn.addEventListener('click', () => {
if (outputText.value) {
const success = speakText(outputText.value);
if (success) {
// Update button to show speaking state
updateSpeakButtonState(true);
// Show feedback toast
showFeedbackToast(`Speaking: "${outputText.value.substring(0, 30)}${outputText.value.length > 30 ? '...' : ''}"`);
// Add to history
const now = new Date();
const timeString = now.getHours() + ':' + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes() + ' ' + (now.getHours() >= 12 ? 'PM' : 'AM');
mockHistory.unshift({
text: outputText.value,
time: timeString,
context: currentCategory.charAt(0).toUpperCase() + currentCategory.slice(1)
});
if (mockHistory.length > 10) {
mockHistory.pop();
}
updateHistory(currentFilter);
}
}
});
// Add event listeners for quick category buttons
document.querySelectorAll('.quick-category').forEach(button => {
button.addEventListener('click', () => {
const category = button.dataset.category;
// Add visual feedback
button.classList.add('border-primary', 'shadow-md');
setTimeout(() => {
button.classList.remove('border-primary', 'shadow-md');
// Find and click the corresponding category tab
document.querySelector(`.category-tab[data-category="${category}"]`).click();
}, 200);
});
});
// Add event listener for context mode toggle
const contextModeToggle = document.getElementById('contextModeToggle');
let contextModeEnabled = true; // Default to enabled
let contextListeningInterval = null;
let currentContext = 'all';
// Function to detect context based on time, simulated location and activity

async function detectContext() {
  const now = new Date();
  const hour = now.getHours();
  const day = now.getDay();
  const isWeekend = day === 0 || day === 6;
  const dayContext = isWeekend ? 'Weekend' : 'Weekday';

  let timeContext, locationContext, activityContext, contextCategory, suggestions;

  if (hour >= 5 && hour < 12) {
    timeContext = 'Morning';
  } else if (hour >= 12 && hour < 17) {
    timeContext = 'Afternoon';
  } else if (hour >= 17 && hour < 22) {
    timeContext = 'Evening';
  } else {
    timeContext = 'Night';
  }

  // Fetch dynamic location
  locationContext = await fetchUserLocationName();

  if (hour >= 6 && hour < 10) {
    contextCategory = 'home';
    activityContext = 'morning routine';
    suggestions = ["Good morning", "I'd like some coffee please", "What's the weather today?", "I need help getting dressed", "Time for breakfast"];
  } else if (hour >= 11 && hour < 14) {
    contextCategory = 'food';
    activityContext = 'lunch time';
    suggestions = ["I'm hungry", "What's for lunch?", "Could I have some water?", "This tastes delicious", "I'd like some more please"];
  } else if (hour >= 14 && hour < 17) {
    contextCategory = 'social';
    activityContext = 'afternoon activities';
    suggestions = ["How are you today?", "I'd like to go outside", "Can we watch TV?", "I enjoyed our conversation", "Let's do something together"];
  } else if (hour >= 17 && hour < 20) {
    contextCategory = 'food';
    activityContext = 'dinner time';
    suggestions = ["What's for dinner?", "I'm thirsty", "This is delicious", "I'm full now", "Thank you for the meal"];
  } else if (hour >= 20 && hour < 23) {
    contextCategory = 'home';
    activityContext = 'evening routine';
    suggestions = ["I'd like to watch a movie", "Could you turn down the lights?", "I'm getting tired", "It's been a good day", "I need my medication"];
  } else {
    contextCategory = 'health';
    activityContext = 'night time';
    suggestions = ["I can't sleep", "I need water", "I need help to the bathroom", "I'm not feeling well", "Could you adjust my pillow?"];
  }

  return {
    context: contextCategory,
    activity: activityContext,
    location: locationContext,
    timeContext: timeContext,
    dayContext: dayContext,
    suggestions: suggestions
  };
}



function updateContextDisplay(contextInfo) {
// Find and click the corresponding category tab
const categoryTab = document.querySelector(`.category-tab[data-category="${contextInfo.context}"]`);
if (categoryTab && !categoryTab.classList.contains('bg-primary')) {
categoryTab.click();
}
// Update the context chips
const timeContextEl = document.getElementById('timeContext');
const locationContextEl = document.getElementById('locationContext');
const dayContextEl = document.getElementById('dayContext');
const activeContextInfo = document.getElementById('activeContextInfo');
if (timeContextEl && locationContextEl && dayContextEl) {
timeContextEl.textContent = contextInfo.timeContext;
locationContextEl.textContent = contextInfo.location;
dayContextEl.textContent = contextInfo.dayContext;
activeContextInfo.style.opacity = '1';
}
// Also update the listening overlay context display
const currentTimeContext = document.getElementById('currentTimeContext');
const currentLocationContext = document.getElementById('currentLocationContext');
const currentDayContext = document.getElementById('currentDayContext');
if (currentTimeContext && currentLocationContext && currentDayContext) {
currentTimeContext.textContent = contextInfo.timeContext;
currentLocationContext.textContent = contextInfo.location;
currentDayContext.textContent = contextInfo.dayContext;
}
// Update suggestions with context-specific ones
if (contextInfo.suggestions && contextInfo.suggestions.length > 0) {
const suggestionsContainer = document.getElementById('suggestions');
suggestionsContainer.innerHTML = '';
// Add a context indicator at the beginning
const contextIndicator = document.createElement('div');
contextIndicator.className = 'px-4 py-2 bg-primary text-white rounded-full whitespace-nowrap text-sm font-medium context-active flex items-center space-x-2';
contextIndicator.innerHTML = `
<i class="ri-radar-line"></i>
<span>${contextInfo.activity}</span>
`;
suggestionsContainer.appendChild(contextIndicator);
contextInfo.suggestions.forEach(phrase => {
const button = document.createElement('button');
button.className = 'suggestion-btn px-4 py-2 bg-primary bg-opacity-10 text-primary rounded-full whitespace-nowrap text-sm font-medium hover:bg-opacity-20 cursor-pointer keyboard-focus';
button.textContent = phrase;
button.dataset.category = contextInfo.context;
button.setAttribute('tabindex', '0');
button.addEventListener('click', () => {
document.getElementById('outputText').value = phrase;
});
suggestionsContainer.appendChild(button);
});
}
// Show context information in a toast
showFeedbackToast(`Context detected: ${contextInfo.timeContext} | ${contextInfo.location} | ${contextInfo.dayContext}`);
}
async function startContextListening() {
// Initial context detection
const contextInfo = await detectContext();
currentContext = contextInfo.context;
updateContextDisplay(contextInfo);
// Set up interval to periodically check for context changes (every 30 seconds)
contextListeningInterval = setInterval(() => {
  (async () => {
    const newContextInfo = await detectContext();
    if (newContextInfo.context !== currentContext) {
      currentContext = newContextInfo.context;
      updateContextDisplay(newContextInfo);
    }
  })();
}, 30000);

// Simulate occasional automatic listening based on context
setTimeout(() => {
if (contextModeEnabled && Math.random() > 0.7) {
// 30% chance of auto-listening
startListening();
}
}, 45000);
}
function stopContextListening() {
if (contextListeningInterval) {
clearInterval(contextListeningInterval);
contextListeningInterval = null;
}
}
// Show tooltip on hover for context mode toggle
contextModeToggle.addEventListener('mouseenter', () => {
document.getElementById('contextTooltip').classList.remove('hidden');
});
contextModeToggle.addEventListener('mouseleave', () => {
document.getElementById('contextTooltip').classList.add('hidden');
});
// Initialize context mode (enabled by default)
function initContextMode() {
if (contextModeEnabled) {
startContextListening();
document.getElementById('activeContextInfo').style.opacity = '1';
}
}
// Call this after DOM is loaded
initContextMode();
contextModeToggle.addEventListener('click', () => {
contextModeEnabled = !contextModeEnabled;
// Update toggle button appearance
if (contextModeEnabled) {
contextModeToggle.classList.remove('bg-gray-100', 'text-gray-700');
contextModeToggle.classList.add('bg-primary', 'text-white');
contextModeToggle.querySelector('i').classList.replace('ri-brain-line', 'ri-radar-line');
contextModeToggle.querySelector('span:first-of-type').textContent = 'Smart Context';
contextModeToggle.querySelector('span:last-of-type').textContent = 'ON';
contextModeToggle.querySelector('span:last-of-type').classList.remove('bg-gray-200', 'text-gray-600');
contextModeToggle.querySelector('span:last-of-type').classList.add('bg-white', 'text-primary');
// Start context detection
startContextListening();
// Show the context info chips
document.getElementById('activeContextInfo').style.opacity = '1';
} else {
contextModeToggle.classList.remove('bg-primary', 'text-white');
contextModeToggle.classList.add('bg-gray-100', 'text-gray-700');
contextModeToggle.querySelector('i').classList.replace('ri-radar-line', 'ri-brain-line');
contextModeToggle.querySelector('span:first-of-type').textContent = 'Smart Context';
contextModeToggle.querySelector('span:last-of-type').textContent = 'OFF';
contextModeToggle.querySelector('span:last-of-type').classList.remove('bg-white', 'text-primary');
contextModeToggle.querySelector('span:last-of-type').classList.add('bg-gray-200', 'text-gray-600');
// Stop context detection
stopContextListening();
// Hide the context info chips
document.getElementById('activeContextInfo').style.opacity = '0';
}
showFeedbackToast(contextModeEnabled ? 'Smart Context Enabled: Suggestions adapt to your environment' : 'Smart Context Disabled: Manual category selection');
});
// Manual override button
const manualOverrideBtn = document.getElementById('manualOverrideBtn');
const manualOverrideModal = document.getElementById('manualOverrideModal');
const closeOverrideModal = document.getElementById('closeOverrideModal');
if (closeOverrideModal) {
  closeOverrideModal.addEventListener('click', () => {
    manualOverrideModal.classList.add('hidden');
  });
} else {
  console.warn('Element #closeOverrideModal not found.');
}
const cancelOverride = document.getElementById('cancelOverride');
const saveOverride = document.getElementById('saveOverride');
const timeContextOverride = document.getElementById('timeContextOverride');
const locationContextOverride = document.getElementById('locationContextOverride');
const dayContextOverride = document.getElementById('dayContextOverride');
manualOverrideBtn.addEventListener('click', async () => {
if (contextModeEnabled) {
// Get current context values
const contextInfo = await detectContext();
timeContextOverride.value = contextInfo.timeContext;
locationContextOverride.value = contextInfo.location;
dayContextOverride.value = contextInfo.dayContext;
manualOverrideModal.classList.remove('hidden');
}
});
closeOverrideModal.addEventListener('click', () => {
manualOverrideModal.classList.add('hidden');
});
cancelOverride.addEventListener('click', () => {
manualOverrideModal.classList.add('hidden');
});
saveOverride.addEventListener('click', () => {
// Get the selected values
const timeContext = timeContextOverride.value;
const locationContext = locationContextOverride.value;
const dayContext = dayContextOverride.value;
// Update the context chips
document.getElementById('timeContext').textContent = timeContext;
document.getElementById('locationContext').textContent = locationContext;
document.getElementById('dayContext').textContent = dayContext;
// Update the context in the listening overlay
document.getElementById('currentTimeContext').textContent = timeContext;
document.getElementById('currentLocationContext').textContent = locationContext;
document.getElementById('currentDayContext').textContent = dayContext;
// Show feedback
showFeedbackToast(`Context manually set to: ${timeContext} | ${locationContext} | ${dayContext}`);
// Close the modal
manualOverrideModal.classList.add('hidden');
});
// Voice settings
maleVoiceBtn.addEventListener('click', () => {
selectedVoiceGender = 'male';
maleVoiceBtn.classList.remove('bg-gray-100', 'text-gray-700');
maleVoiceBtn.classList.add('bg-primary', 'text-white');
femaleVoiceBtn.classList.remove('bg-primary', 'text-white');
femaleVoiceBtn.classList.add('bg-gray-100', 'text-gray-700');
showFeedbackToast('Male voice selected');
});
femaleVoiceBtn.addEventListener('click', () => {
selectedVoiceGender = 'female';
femaleVoiceBtn.classList.remove('bg-gray-100', 'text-gray-700');
femaleVoiceBtn.classList.add('bg-primary', 'text-white');
maleVoiceBtn.classList.remove('bg-primary', 'text-white');
maleVoiceBtn.classList.add('bg-gray-100', 'text-gray-700');
showFeedbackToast('Female voice selected');
});
voiceSpeed.addEventListener('input', () => {
voiceRate = parseFloat(voiceSpeed.value);
});
voicePitch.addEventListener('input', () => {
voicePitch = parseFloat(voicePitch.value);
});
// Language settings
languageSelector.addEventListener('click', () => {
languageDropdown.classList.toggle('hidden');
});
document.addEventListener('click', (e) => {
if (!languageSelector.contains(e.target) && !languageDropdown.contains(e.target)) {
languageDropdown.classList.add('hidden');
}
});
languageOptions.forEach(option => {
option.addEventListener('click', () => {
const lang = option.dataset.lang;
currentLanguage = lang;
document.getElementById('currentLanguage').textContent = option.textContent;
languageDropdown.classList.add('hidden');
showFeedbackToast(`Language changed to ${option.textContent}`);
});
});
// Add new phrase functionality
function updateSavedPhrases() {
const savedPhrasesContainer = document.querySelector('.space-y-2');
savedPhrasesContainer.innerHTML = '';
savedPhrases.forEach(phrase => {
const button = document.createElement('button');
button.className = 'w-full px-4 py-2 bg-gray-100 rounded-lg text-left text-sm text-gray-700 hover:bg-gray-200 cursor-pointer';
button.textContent = phrase;
button.addEventListener('click', () => {
outputText.value = phrase;
profileModal.classList.add('hidden');
});
savedPhrasesContainer.appendChild(button);
});
}
addNewPhraseBtn.addEventListener('click', () => {
newPhraseModal.classList.remove('hidden');
newPhraseText.focus();
});
closeNewPhraseModal.addEventListener('click', () => {
newPhraseModal.classList.add('hidden');
});
cancelNewPhrase.addEventListener('click', () => {
newPhraseModal.classList.add('hidden');
});
saveNewPhrase.addEventListener('click', () => {
const phraseText = newPhraseText.value.trim();
if (phraseText) {
savedPhrases.push(phraseText);
updateSavedPhrases();
newPhraseText.value = '';
newPhraseModal.classList.add('hidden');
showFeedbackToast('New phrase added');
} else {
showFeedbackToast('Please enter a phrase');
}
});
// Keyboard navigation
document.addEventListener('keydown', (e) => {
// Press Enter when focused on a button to click it
if (e.key === 'Enter' && document.activeElement.tagName === 'BUTTON') {
document.activeElement.click();
}
// Press Escape to close modals and stop listening
if (e.key === 'Escape') {
settingsModal.classList.add('hidden');
profileModal.classList.add('hidden');
historyFilterDropdown.classList.add('hidden');
languageDropdown.classList.add('hidden');
newPhraseModal.classList.add('hidden');
feedbackToast.classList.remove('show');
// Also stop listening if active
if (isRecording) {
stopListening();
}
}
// Ctrl+M to toggle mic
if (e.ctrlKey && e.key === 'm') {
e.preventDefault();
micBtn.click();
}
// Ctrl+S to speak
if (e.ctrlKey && e.key === 's') {
e.preventDefault();
speakBtn.click();
}
// Ctrl+L to clear
if (e.ctrlKey && e.key === 'l') {
e.preventDefault();
clearBtn.click();
}
// Space to start/stop listening when overlay is active
if (e.key === ' ' && listeningOverlay.classList.contains('active')) {
e.preventDefault();
stopListening();
}
});
// Initialize saved phrases
updateSavedPhrases();
});
</script>
<!-- Add this inside your <body> tag, near the end -->
    <div id="manualOverrideModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Manual Context Override</h3>
            <button id="closeOverrideModal" class="text-gray-600 hover:text-primary">
              <i class="ri-close-line ri-lg"></i>
            </button>
          </div>
          <div class="space-y-4">
            <div>
              <label for="timeContextOverride" class="block text-sm font-medium text-gray-700">Time of Day</label>
              <input id="timeContextOverride" class="w-full border rounded px-3 py-2" placeholder="e.g. Morning">
            </div>
            <div>
              <label for="locationContextOverride" class="block text-sm font-medium text-gray-700">Location</label>
              <input id="locationContextOverride" class="w-full border rounded px-3 py-2" placeholder="e.g. Home">
            </div>
            <div>
              <label for="dayContextOverride" class="block text-sm font-medium text-gray-700">Day Type</label>
              <input id="dayContextOverride" class="w-full border rounded px-3 py-2" placeholder="e.g. Weekday">
            </div>
            <div class="flex justify-end space-x-3 pt-4">
              <button id="cancelOverride" class="px-4 py-2 bg-gray-100 text-gray-700 rounded">Cancel</button>
              <button id="saveOverride" class="px-4 py-2 bg-primary text-white rounded">Save</button>
            </div>
          </div>
        </div>
      </div>
      
</body>
</html>
